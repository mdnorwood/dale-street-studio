{"ast":null,"code":"\"use strict\";\n\nvar PNG = require(\"pngjs\").PNG;\n\nvar through = require(\"through\");\n\nfunction handleData(array, data) {\n  var i,\n      j,\n      ptr = 0,\n      c;\n\n  if (array.shape.length === 3) {\n    if (array.shape[2] === 3) {\n      for (i = 0; i < array.shape[0]; ++i) {\n        for (j = 0; j < array.shape[1]; ++j) {\n          data[ptr++] = array.get(i, j, 0) >>> 0;\n          data[ptr++] = array.get(i, j, 1) >>> 0;\n          data[ptr++] = array.get(i, j, 2) >>> 0;\n          data[ptr++] = 255;\n        }\n      }\n    } else if (array.shape[2] === 4) {\n      for (i = 0; i < array.shape[0]; ++i) {\n        for (j = 0; j < array.shape[1]; ++j) {\n          data[ptr++] = array.get(i, j, 0) >>> 0;\n          data[ptr++] = array.get(i, j, 1) >>> 0;\n          data[ptr++] = array.get(i, j, 2) >>> 0;\n          data[ptr++] = array.get(i, j, 3) >>> 0;\n        }\n      }\n    } else if (array.shape[3] === 1) {\n      for (i = 0; i < array.shape[0]; ++i) {\n        for (j = 0; j < array.shape[1]; ++j) {\n          var c = array.get(i, j, 0) >>> 0;\n          data[ptr++] = c;\n          data[ptr++] = c;\n          data[ptr++] = c;\n          data[ptr++] = 255;\n        }\n      }\n    } else {\n      return new Error(\"Incompatible array shape\");\n    }\n  } else if (array.shape.length === 2) {\n    for (i = 0; i < array.shape[0]; ++i) {\n      for (j = 0; j < array.shape[1]; ++j) {\n        var c = array.get(i, j, 0) >>> 0;\n        data[ptr++] = c;\n        data[ptr++] = c;\n        data[ptr++] = c;\n        data[ptr++] = 255;\n      }\n    }\n  } else {\n    return new Error(\"Incompatible array shape\");\n  }\n\n  return data;\n}\n\nfunction haderror(err) {\n  var result = through();\n  result.emit(\"error\", err);\n  return result;\n}\n\nmodule.exports = function savePixels(array, type) {\n  switch (type.toUpperCase()) {\n    case \"PNG\":\n    case \".PNG\":\n      var png = new PNG({\n        width: array.shape[1],\n        height: array.shape[0]\n      });\n      var data = handleData(array, png.data);\n      if (typeof data === \"Error\") return haderror(data);\n      png.data = data;\n      return png.pack();\n\n    case \"CANVAS\":\n      var canvas = document.createElement(\"canvas\");\n      var context = canvas.getContext(\"2d\");\n      canvas.width = array.shape[1];\n      canvas.height = array.shape[0];\n      var imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n      var data = imageData.data;\n      data = handleData(array, data);\n      if (typeof data === \"Error\") return haderror(data);\n      context.putImageData(imageData, 0, 0);\n      return canvas;\n\n    default:\n      return haderror(new Error(\"Unsupported file type: \" + type));\n  }\n};","map":{"version":3,"sources":["/Users/marcusnorwood/Sites/music-site/dale-street-studio-music/client/node_modules/save-pixels/save-pixels.js"],"names":["PNG","require","through","handleData","array","data","i","j","ptr","c","shape","length","get","Error","haderror","err","result","emit","module","exports","savePixels","type","toUpperCase","png","width","height","pack","canvas","document","createElement","context","getContext","imageData","getImageData","putImageData"],"mappings":"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","sourcesContent":["\"use strict\"\n\nvar PNG = require(\"pngjs\").PNG\nvar through = require(\"through\")\n\nfunction handleData(array, data) {\n  var i, j, ptr = 0, c\n  if(array.shape.length === 3) {\n    if(array.shape[2] === 3) {\n      for(i=0; i<array.shape[0]; ++i) {\n        for(j=0; j<array.shape[1]; ++j) {\n          data[ptr++] = array.get(i,j,0)>>>0\n          data[ptr++] = array.get(i,j,1)>>>0\n          data[ptr++] = array.get(i,j,2)>>>0\n          data[ptr++] = 255\n        }\n      }\n    } else if(array.shape[2] === 4) {\n      for(i=0; i<array.shape[0]; ++i) {\n        for(j=0; j<array.shape[1]; ++j) {\n          data[ptr++] = array.get(i,j,0)>>>0\n          data[ptr++] = array.get(i,j,1)>>>0\n          data[ptr++] = array.get(i,j,2)>>>0\n          data[ptr++] = array.get(i,j,3)>>>0\n        }\n      }\n    } else if(array.shape[3] === 1) {\n      for(i=0; i<array.shape[0]; ++i) {\n        for(j=0; j<array.shape[1]; ++j) {\n          var c = array.get(i,j,0)>>>0\n          data[ptr++] = c\n          data[ptr++] = c\n          data[ptr++] = c\n          data[ptr++] = 255\n        }\n      }\n    } else {\n      return new Error(\"Incompatible array shape\")\n    }\n  } else if(array.shape.length === 2) {\n    for(i=0; i<array.shape[0]; ++i) {\n      for(j=0; j<array.shape[1]; ++j) {\n        var c = array.get(i,j,0)>>>0\n        data[ptr++] = c\n        data[ptr++] = c\n        data[ptr++] = c\n        data[ptr++] = 255\n      }\n    }\n  } else {\n    return new Error(\"Incompatible array shape\")\n  }\n  return data\n}\n\nfunction haderror(err) {\n  var result = through()\n  result.emit(\"error\", err)\n  return result\n}\n\nmodule.exports = function savePixels(array, type) {\n  switch(type.toUpperCase()) {\n    case \"PNG\":\n    case \".PNG\":\n      var png = new PNG({\n        width: array.shape[1],\n        height: array.shape[0]\n      })\n      var data = handleData(array, png.data)\n      if (typeof data === \"Error\") return haderror(data)\n      png.data = data\n      return png.pack()\n\n    case \"CANVAS\":\n      var canvas = document.createElement(\"canvas\")\n      var context = canvas.getContext(\"2d\")\n      canvas.width = array.shape[1]\n      canvas.height = array.shape[0]\n      var imageData = context.getImageData(0, 0, canvas.width, canvas.height)\n      var data = imageData.data\n      data = handleData(array, data)\n      if (typeof data === \"Error\") return haderror(data)\n      context.putImageData(imageData, 0, 0)\n      return canvas\n    \n    default:\n      return haderror(new Error(\"Unsupported file type: \" + type))\n  }\n}\n"]},"metadata":{},"sourceType":"script"}