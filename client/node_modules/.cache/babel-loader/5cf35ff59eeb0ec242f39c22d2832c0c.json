{"ast":null,"code":"\"use strict\";\n\nvar util = require(\"util\");\n\nvar Stream = require(\"stream\");\n\nvar constants = require(\"./constants\");\n\nvar Packer = require(\"./packer\");\n\nvar PackerAsync = module.exports = function (opt) {\n  Stream.call(this);\n  var options = opt || {};\n  this._packer = new Packer(options);\n  this._deflate = this._packer.createDeflate();\n  this.readable = true;\n};\n\nutil.inherits(PackerAsync, Stream);\n\nPackerAsync.prototype.pack = function (data, width, height, gamma) {\n  // Signature\n  this.emit(\"data\", Buffer.from(constants.PNG_SIGNATURE));\n  this.emit(\"data\", this._packer.packIHDR(width, height));\n\n  if (gamma) {\n    this.emit(\"data\", this._packer.packGAMA(gamma));\n  }\n\n  var filteredData = this._packer.filterData(data, width, height); // compress it\n\n\n  this._deflate.on(\"error\", this.emit.bind(this, \"error\"));\n\n  this._deflate.on(\"data\", function (compressedData) {\n    this.emit(\"data\", this._packer.packIDAT(compressedData));\n  }.bind(this));\n\n  this._deflate.on(\"end\", function () {\n    this.emit(\"data\", this._packer.packIEND());\n    this.emit(\"end\");\n  }.bind(this));\n\n  this._deflate.end(filteredData);\n};","map":{"version":3,"sources":["/Users/marcusnorwood/Sites/music-site/dale-street-studio-music/client/node_modules/pngjs/lib/packer-async.js"],"names":["util","require","Stream","constants","Packer","PackerAsync","module","exports","opt","call","options","_packer","_deflate","createDeflate","readable","inherits","prototype","pack","data","width","height","gamma","emit","Buffer","from","PNG_SIGNATURE","packIHDR","packGAMA","filteredData","filterData","on","bind","compressedData","packIDAT","packIEND","end"],"mappings":"AAAA;;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIE,SAAS,GAAGF,OAAO,CAAC,aAAD,CAAvB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,UAAD,CAApB;;AAEA,IAAII,WAAW,GAAIC,MAAM,CAACC,OAAP,GAAiB,UAAUC,GAAV,EAAe;AACjDN,EAAAA,MAAM,CAACO,IAAP,CAAY,IAAZ;AAEA,MAAIC,OAAO,GAAGF,GAAG,IAAI,EAArB;AAEA,OAAKG,OAAL,GAAe,IAAIP,MAAJ,CAAWM,OAAX,CAAf;AACA,OAAKE,QAAL,GAAgB,KAAKD,OAAL,CAAaE,aAAb,EAAhB;AAEA,OAAKC,QAAL,GAAgB,IAAhB;AACD,CATD;;AAUAd,IAAI,CAACe,QAAL,CAAcV,WAAd,EAA2BH,MAA3B;;AAEAG,WAAW,CAACW,SAAZ,CAAsBC,IAAtB,GAA6B,UAAUC,IAAV,EAAgBC,KAAhB,EAAuBC,MAAvB,EAA+BC,KAA/B,EAAsC;AACjE;AACA,OAAKC,IAAL,CAAU,MAAV,EAAkBC,MAAM,CAACC,IAAP,CAAYrB,SAAS,CAACsB,aAAtB,CAAlB;AACA,OAAKH,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAae,QAAb,CAAsBP,KAAtB,EAA6BC,MAA7B,CAAlB;;AAEA,MAAIC,KAAJ,EAAW;AACT,SAAKC,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAagB,QAAb,CAAsBN,KAAtB,CAAlB;AACD;;AAED,MAAIO,YAAY,GAAG,KAAKjB,OAAL,CAAakB,UAAb,CAAwBX,IAAxB,EAA8BC,KAA9B,EAAqCC,MAArC,CAAnB,CATiE,CAWjE;;;AACA,OAAKR,QAAL,CAAckB,EAAd,CAAiB,OAAjB,EAA0B,KAAKR,IAAL,CAAUS,IAAV,CAAe,IAAf,EAAqB,OAArB,CAA1B;;AAEA,OAAKnB,QAAL,CAAckB,EAAd,CACE,MADF,EAEE,UAAUE,cAAV,EAA0B;AACxB,SAAKV,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAasB,QAAb,CAAsBD,cAAtB,CAAlB;AACD,GAFD,CAEED,IAFF,CAEO,IAFP,CAFF;;AAOA,OAAKnB,QAAL,CAAckB,EAAd,CACE,KADF,EAEE,YAAY;AACV,SAAKR,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAauB,QAAb,EAAlB;AACA,SAAKZ,IAAL,CAAU,KAAV;AACD,GAHD,CAGES,IAHF,CAGO,IAHP,CAFF;;AAQA,OAAKnB,QAAL,CAAcuB,GAAd,CAAkBP,YAAlB;AACD,CA9BD","sourcesContent":["\"use strict\";\n\nlet util = require(\"util\");\nlet Stream = require(\"stream\");\nlet constants = require(\"./constants\");\nlet Packer = require(\"./packer\");\n\nlet PackerAsync = (module.exports = function (opt) {\n  Stream.call(this);\n\n  let options = opt || {};\n\n  this._packer = new Packer(options);\n  this._deflate = this._packer.createDeflate();\n\n  this.readable = true;\n});\nutil.inherits(PackerAsync, Stream);\n\nPackerAsync.prototype.pack = function (data, width, height, gamma) {\n  // Signature\n  this.emit(\"data\", Buffer.from(constants.PNG_SIGNATURE));\n  this.emit(\"data\", this._packer.packIHDR(width, height));\n\n  if (gamma) {\n    this.emit(\"data\", this._packer.packGAMA(gamma));\n  }\n\n  let filteredData = this._packer.filterData(data, width, height);\n\n  // compress it\n  this._deflate.on(\"error\", this.emit.bind(this, \"error\"));\n\n  this._deflate.on(\n    \"data\",\n    function (compressedData) {\n      this.emit(\"data\", this._packer.packIDAT(compressedData));\n    }.bind(this)\n  );\n\n  this._deflate.on(\n    \"end\",\n    function () {\n      this.emit(\"data\", this._packer.packIEND());\n      this.emit(\"end\");\n    }.bind(this)\n  );\n\n  this._deflate.end(filteredData);\n};\n"]},"metadata":{},"sourceType":"script"}